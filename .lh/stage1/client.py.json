{
    "sourceFile": "stage1/client.py",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 16,
            "patches": [
                {
                    "date": 1652554336335,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1652554355426,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -42,9 +42,11 @@\n             self.socket.sendto(b'heartbeat', (self.serverAddr, self.serverPort))\n             print(\"Heartbeat enviado\")\n             data, addr = self.socket.recvfrom(self.buffer)\n             data = data.decode()\n-            if data.split('-')[0] == 'hearbeatOk'\n+            if data.split('-')[0] == 'hearbeatOk':\n+                print(\"Heartbeat OK\")\n+            print(\"Heartbeat standby\")\n \n     \n     \n     \n"
                },
                {
                    "date": 1652554424672,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,8 +35,15 @@\n                 self.socket.sendto(b'readyOk', addr)\n                 print(\"Estado Ready enviado\")\n                 print(\"A entrar em heartbeat\")\n                 break\n+            elif data.split('-')[0] == 'mcast?':\n+                print(\"Servidor a perguntar o endereço multicast:\")\n+                self.socket.sendto(b'mcastOk', addr)\n+                print(\"Endereço multicast enviado\")\n+                print(\"A entrar em heartbeat\")\n+                break\n+        self.heartbeat()\n     \n     def heartbeat(self):\n         while True:\n             self.socket.sendto(b'heartbeat', (self.serverAddr, self.serverPort))\n"
                },
                {
                    "date": 1652554464235,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -53,15 +53,16 @@\n             if data.split('-')[0] == 'hearbeatOk':\n                 print(\"Heartbeat OK\")\n             print(\"Heartbeat standby\")\n \n+    def run(self):\n+        self.auth()\n     \n     \n     \n     \n     \n     \n-    \n def main():\n     serverAddr = sys.argv[1]\n     serverPort = int(sys.argv[2])\n     \n\\ No newline at end of file\n"
                },
                {
                    "date": 1652554514961,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,8 +6,9 @@\n gameOn = 0\n \n class Auth(threading.Thread):\n     def __init__(self, serverAddr, serverPort):\n+        threading.Thread.__init__(self)\n         self.mcaddr = \"\"\n         self.serverAddr = serverAddr\n         self.serverPort = serverPort\n         \n@@ -57,12 +58,15 @@\n     def run(self):\n         self.auth()\n     \n     \n+\n+class Game(threading.Thread):\n+    def __init__(self):\n+        \n     \n     \n     \n-    \n def main():\n     serverAddr = sys.argv[1]\n     serverPort = int(sys.argv[2])\n     \n\\ No newline at end of file\n"
                },
                {
                    "date": 1652554559391,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,13 +3,13 @@\n import time, struct, socket, sys, threading, pickle, Receiver, Player, json, pickle\n \n \n gameOn = 0\n+mcaddr = \"\"\n \n class Auth(threading.Thread):\n     def __init__(self, serverAddr, serverPort):\n         threading.Thread.__init__(self)\n-        self.mcaddr = \"\"\n         self.serverAddr = serverAddr\n         self.serverPort = serverPort\n         \n         self.socket = socket.socket(socket.AF_INET6, socket.SOCK_DGRAM)\n@@ -26,9 +26,9 @@\n             data, addr = self.socket.recvfrom(self.buffer)\n             data = data.decode()\n             if data.split('-')[0] == 'hello-':\n                 print(\"Autenticado com sucesso\")\n-                data.split('-')[2] = self.mcaddr\n+                data.split('-')[2] = mcaddr\n                 print(\"Endereço multicast recebido: \" + data.split('-')[2])\n                 print(self.mcaddr)\n                 self.socket.sendto(b'mcast-ok', addr)\n             elif data.split('-')[0] == 'ready?':\n@@ -61,9 +61,9 @@\n     \n \n class Game(threading.Thread):\n     def __init__(self):\n-        \n+        self.\n     \n     \n     \n def main():\n"
                },
                {
                    "date": 1652554564844,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,8 +17,9 @@\n         self.buffer = 2048\n         \n         \n     def auth(self):\n+        global mcaddr\n         self.socket=socket.socket(socket.AF_INET6, socket.SOCK_DGRAM)\n         self.socket.bind(('', self.serverPort))\n         print(\"A tentar autenticar com o servidor\")\n         self.socket.sendto(b'new-', (self.serverAddr, self.serverPort))\n"
                },
                {
                    "date": 1652554869917,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -61,13 +61,26 @@\n     \n     \n \n class Game(threading.Thread):\n-    def __init__(self):\n-        self.\n+    def __init__(self,addr):\n+        self.socket = socket.socket(socket.AF_INET6, socket.SOCK_DGRAM)\n+        self.port = 8888\n+        self.buffer = 2048\n+        self.socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n+        self.socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEPORT, 1)\n+        self.mcastAddr = addr\n+        \n+    def gameQueue():\n+        while True:\n+            print(\"Binding to multicast Group...\")\n+            self.socket.bind((self.mcastAddr, self.port))\n+        \n+        \n+    def playGame():\n+\n     \n     \n-    \n def main():\n     serverAddr = sys.argv[1]\n     serverPort = int(sys.argv[2])\n     \n\\ No newline at end of file\n"
                },
                {
                    "date": 1652555802174,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,8 +4,9 @@\n \n \n gameOn = 0\n mcaddr = \"\"\n+serverAddr = \"\"\n \n class Auth(threading.Thread):\n     def __init__(self, serverAddr, serverPort):\n         threading.Thread.__init__(self)\n@@ -62,25 +63,54 @@\n     \n \n class Game(threading.Thread):\n     def __init__(self,addr):\n-        self.socket = socket.socket(socket.AF_INET6, socket.SOCK_DGRAM)\n+        self.socket = socket.socket(socket.AF_INET6, socket.SOCK_DGRAM,socket.IPPROTO_UDP)\n         self.port = 8888\n         self.buffer = 2048\n-        self.socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)\n-        self.socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEPORT, 1)\n         self.mcastAddr = addr\n         \n-    def gameQueue():\n+        self.controlSocket = socket.socket(socket.AF_INET6, socket.SOCK_DGRAM)\n+        self.controlPort = 8081\n+        self.controlSocket.bind('', self.controlPort)\n+        \n+        \n+        \n+        \n+    def gameQueue(self):\n         while True:\n             print(\"Binding to multicast Group...\")\n             self.socket.bind((self.mcastAddr, self.port))\n+\n         \n-        \n-    def playGame():\n \n     \n     \n+    def run(self):\n+        try:\n+            self.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)    \n+        except Exception as e:\n+            print (\"Error: %s\" % e)\n+            pass\n+        self.socket.setsockopt(socket.IPPROTO_IP, socket.IP_MULTICAST_TTL, 32)\n+        self.socket.setsockopt(socket.IPPROTO_IP, socket.IP_MULTICAST_LOOP, 1)\n+\n+        self.socket.bind(self.mcastAddr, self.port)\n+        host = socket.gethostbyname(socket.gethostname())\n+        self.socket(socket.SOL_IP, socket.IP_MULTICAST_IF, socket.inet_aton(host))\n+        self.setsockopt(socket.SOL_IP, socket.IP_ADD_MEMBERSHIP, socket.inet_aton(self.mcastAddr) + socket.inet_aton(host))\n+        data, addr = self.socket.recvfrom(self.buffer)\n+        data = data.decode()\n+        if data.split('-') == 'startGame-':\n+            print(\"A entrar em heartbeat\")\n+            self.socket.sendto\n+        else:\n+            \n+            \n+                \n+        \n+        \n+        \n def main():\n     serverAddr = sys.argv[1]\n     serverPort = int(sys.argv[2])\n     \n\\ No newline at end of file\n"
                },
                {
                    "date": 1652555815406,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,8 +19,10 @@\n         \n         \n     def auth(self):\n         global mcaddr\n+        global serverAddr\n+        serverAddr = self.serverAddr\n         self.socket=socket.socket(socket.AF_INET6, socket.SOCK_DGRAM)\n         self.socket.bind(('', self.serverPort))\n         print(\"A tentar autenticar com o servidor\")\n         self.socket.sendto(b'new-', (self.serverAddr, self.serverPort))\n"
                },
                {
                    "date": 1652556270282,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -102,13 +102,16 @@\n         self.setsockopt(socket.SOL_IP, socket.IP_ADD_MEMBERSHIP, socket.inet_aton(self.mcastAddr) + socket.inet_aton(host))\n         data, addr = self.socket.recvfrom(self.buffer)\n         data = data.decode()\n         if data.split('-') == 'startGame-':\n-            print(\"A entrar em heartbeat\")\n-            self.socket.sendto\n-        else:\n+            print(\"Inicio de jogo recebido\")\n+            self.controlSocket.sendto('gameStartOk'.encode(), (serverAddr, self.controlPort))\n+            print(\"Inicio de jogo confirmado\")\n+        \n+        \n             \n             \n+            \n                 \n         \n         \n         \n"
                },
                {
                    "date": 1652556349762,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -76,14 +76,10 @@\n         self.controlSocket.bind('', self.controlPort)\n         \n         \n         \n-        \n-    def gameQueue(self):\n-        while True:\n-            print(\"Binding to multicast Group...\")\n-            self.socket.bind((self.mcastAddr, self.port))\n \n+\n         \n \n     \n     \n@@ -92,8 +88,9 @@\n             self.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)    \n         except Exception as e:\n             print (\"Error: %s\" % e)\n             pass\n+        print(\"A tentar a subscricao multicast\")\n         self.socket.setsockopt(socket.IPPROTO_IP, socket.IP_MULTICAST_TTL, 32)\n         self.socket.setsockopt(socket.IPPROTO_IP, socket.IP_MULTICAST_LOOP, 1)\n \n         self.socket.bind(self.mcastAddr, self.port)\n@@ -105,8 +102,9 @@\n         if data.split('-') == 'startGame-':\n             print(\"Inicio de jogo recebido\")\n             self.controlSocket.sendto('gameStartOk'.encode(), (serverAddr, self.controlPort))\n             print(\"Inicio de jogo confirmado\")\n+            self.inGame()\n         \n         \n             \n             \n"
                },
                {
                    "date": 1652557166575,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -73,17 +73,42 @@\n         \n         self.controlSocket = socket.socket(socket.AF_INET6, socket.SOCK_DGRAM)\n         self.controlPort = 8081\n         self.controlSocket.bind('', self.controlPort)\n+        self.options = dict()\n         \n         \n-        \n \n \n+\n+    def inGame(self):\n+        print(\"A espera de ficheiros de musica\")\n+        rec = Receiver.Receiver(self.mcastAddr, self.port, self.buffer)\n+        self.controlSocket.sendto('songOk'.encode(), (serverAddr, self.controlPort))\n+        rec = Receiver.Receiver(self.mcastAddr, self.port, self.buffer)\n+        self.controlSocket.sendto('songOk'.encode(), (serverAddr, self.controlPort))\n+        rec = Receiver.Receiver(self.mcastAddr, self.port, self.buffer)\n+        self.controlSocket.sendto('songOk'.encode(), (serverAddr, self.controlPort))\n+        print(\"Musicas Recebidas\")\n         \n+        while True:\n+            data, addr = self.socket.recvfrom(self.buffer)\n+            if json.loads(data):\n+                self.options = json.loads(data)\n+                print(\"Game Received\")\n+            elif data.decode():\n+                if data.decode() == 'startGame':\n+                    self.controlSocket.sendto('gameStartOk'.encode(), (serverAddr, self.controlPort))\n+                    print(\"Inicio de jogo confirmado\")\n \n+    #Iterar sobre o dicionário options e em cada chave, imprimir os valores e esperar pelo input do utilizador\n+    def gameMenu(self, options):\n+        selections = []\n+        for key in options:\n+            myOptions.append(key)\n+        print(\"Escolha uma das opções:\")\n+        \n     \n-    \n     def run(self):\n         try:\n             self.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)    \n         except Exception as e:\n@@ -98,9 +123,9 @@\n         self.socket(socket.SOL_IP, socket.IP_MULTICAST_IF, socket.inet_aton(host))\n         self.setsockopt(socket.SOL_IP, socket.IP_ADD_MEMBERSHIP, socket.inet_aton(self.mcastAddr) + socket.inet_aton(host))\n         data, addr = self.socket.recvfrom(self.buffer)\n         data = data.decode()\n-        if data.split('-') == 'startGame-':\n+        if data.split('-') == 'loading-':\n             print(\"Inicio de jogo recebido\")\n             self.controlSocket.sendto('gameStartOk'.encode(), (serverAddr, self.controlPort))\n             print(\"Inicio de jogo confirmado\")\n             self.inGame()\n"
                },
                {
                    "date": 1652557806292,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -99,14 +99,50 @@\n                 if data.decode() == 'startGame':\n                     self.controlSocket.sendto('gameStartOk'.encode(), (serverAddr, self.controlPort))\n                     print(\"Inicio de jogo confirmado\")\n \n-    #Iterar sobre o dicionário options e em cada chave, imprimir os valores e esperar pelo input do utilizador\n-    def gameMenu(self, options):\n+    \"\"\"\n+    Iterar sobre o dicionário options e em cada chave, imprimir os valores e esperar pelo input do utilizador\n+    \n+    O dicionario tem o seguinte formato:\n+    \n+             = {\n+                    \"1\": {\n+                        \"1\": \"<artist>-<song>\",   \n+                        \"2\": \"<artist>-<song>\",\n+                        \"3\": \"<artist>-<song>\",\n+                        \"4\": \"<artist>-<song>\",\n+                        },\n+                    \"2\": {\n+                        \"1\": \"<artist>-<song>\",\n+                        \"2\": \"<artist>-<song>\",\n+                        \"3\": \"<artist>-<song>\",\n+                        \"4\": \"<artist>-<song>\",\n+                        },\n+                      \n+    \"\"\"\n+    def play(self, options):\n         selections = []\n-        for key in options:\n-            myOptions.append(key)\n-        print(\"Escolha uma das opções:\")\n+        for game in options:\n+            for key,value in game:\n+                print(\" %s : %s \", key, value)\n+            startTime = time.time()\n+            sel = input(\"Selecione uma das opções: \")\n+            endTime = time.time() - startTime\n+            selections.append(str(sel)+str(endTime))\n+            startTime = 0\n+            endTime = 0\n+        self.controlSocket.sendto(pickle.dumps(selections), (serverAddr, self.controlPort))\n+        print(\"À espera de resultados\")\n+        while True:\n+            data, addr = self.controlSocket.recvfrom(self.buffer)\n+            data = data.decode()\n+            if data.split('-')[0] == \"vencedor\":\n+                winner = data.split('-')[1]\n+                if winner == self.controlSocket.getsockname()[0]:\n+                    print(\"Venceu o jogo!\")\n+                else:\n+                    print(\"Perdeu o jogo!, o vencedor é %s\" % winner)\n         \n     \n     def run(self):\n         try:\n"
                },
                {
                    "date": 1652557897561,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -46,8 +46,13 @@\n                 self.socket.sendto(b'mcastOk', addr)\n                 print(\"Endereço multicast enviado\")\n                 print(\"A entrar em heartbeat\")\n                 break\n+        #Start Game Thread\n+        global gameOn\n+        gameOn = 1\n+        game = Game(mcaddr, serverAddr)\n+        game.start()\n         self.heartbeat()\n     \n     def heartbeat(self):\n         while True:\n@@ -61,9 +66,8 @@\n \n     def run(self):\n         self.auth()\n     \n-    \n \n class Game(threading.Thread):\n     def __init__(self,addr):\n         self.socket = socket.socket(socket.AF_INET6, socket.SOCK_DGRAM,socket.IPPROTO_UDP)\n@@ -141,10 +145,10 @@\n                 if winner == self.controlSocket.getsockname()[0]:\n                     print(\"Venceu o jogo!\")\n                 else:\n                     print(\"Perdeu o jogo!, o vencedor é %s\" % winner)\n-        \n     \n+    \n     def run(self):\n         try:\n             self.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)    \n         except Exception as e:\n"
                },
                {
                    "date": 1652557908202,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -46,11 +46,8 @@\n                 self.socket.sendto(b'mcastOk', addr)\n                 print(\"Endereço multicast enviado\")\n                 print(\"A entrar em heartbeat\")\n                 break\n-        #Start Game Thread\n-        global gameOn\n-        gameOn = 1\n         game = Game(mcaddr, serverAddr)\n         game.start()\n         self.heartbeat()\n     \n"
                },
                {
                    "date": 1652558156486,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -75,10 +75,10 @@\n         self.controlSocket = socket.socket(socket.AF_INET6, socket.SOCK_DGRAM)\n         self.controlPort = 8081\n         self.controlSocket.bind('', self.controlPort)\n         self.options = dict()\n+        self.filePaths = []\n         \n-        \n \n \n \n     def inGame(self):\n@@ -123,8 +123,9 @@\n     \"\"\"\n     def play(self, options):\n         selections = []\n         for game in options:\n+            Player = Player.Player(game, options[game])\n             for key,value in game:\n                 print(\" %s : %s \", key, value)\n             startTime = time.time()\n             sel = input(\"Selecione uma das opções: \")\n"
                }
            ],
            "date": 1652554336335,
            "name": "Commit-0",
            "content": "\nfrom re import S\nimport time, struct, socket, sys, threading, pickle, Receiver, Player, json, pickle\n\n\ngameOn = 0\n\nclass Auth(threading.Thread):\n    def __init__(self, serverAddr, serverPort):\n        self.mcaddr = \"\"\n        self.serverAddr = serverAddr\n        self.serverPort = serverPort\n        \n        self.socket = socket.socket(socket.AF_INET6, socket.SOCK_DGRAM)\n        self.hport = 8081\n        self.buffer = 2048\n        \n        \n    def auth(self):\n        self.socket=socket.socket(socket.AF_INET6, socket.SOCK_DGRAM)\n        self.socket.bind(('', self.serverPort))\n        print(\"A tentar autenticar com o servidor\")\n        self.socket.sendto(b'new-', (self.serverAddr, self.serverPort))\n        while True:\n            data, addr = self.socket.recvfrom(self.buffer)\n            data = data.decode()\n            if data.split('-')[0] == 'hello-':\n                print(\"Autenticado com sucesso\")\n                data.split('-')[2] = self.mcaddr\n                print(\"Endereço multicast recebido: \" + data.split('-')[2])\n                print(self.mcaddr)\n                self.socket.sendto(b'mcast-ok', addr)\n            elif data.split('-')[0] == 'ready?':\n                print(\"Servidor a perguntar se estamos prontos:\")\n                self.socket.sendto(b'readyOk', addr)\n                print(\"Estado Ready enviado\")\n                print(\"A entrar em heartbeat\")\n                break\n    \n    def heartbeat(self):\n        while True:\n            self.socket.sendto(b'heartbeat', (self.serverAddr, self.serverPort))\n            print(\"Heartbeat enviado\")\n            data, addr = self.socket.recvfrom(self.buffer)\n            data = data.decode()\n            if data.split('-')[0] == 'hearbeatOk'\n\n    \n    \n    \n    \n    \n    \n    \ndef main():\n    serverAddr = sys.argv[1]\n    serverPort = int(sys.argv[2])\n    "
        }
    ]
}